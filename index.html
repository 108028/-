<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>帳號管理系統</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 50px;
    }
    form, .hidden {
      display: none;
    }
    form.active, #account-section.active {
      display: block;
    }
    input, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 10px;
    }
    button {
      cursor: pointer;
    }
    #toggle {
      background: none;
      border: none;
      color: blue;
      cursor: pointer;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h1>帳號管理系統</h1>

  <!-- 登入表單 -->
  <form id="login-form" class="active">
    <h2>登入</h2>
    <input type="text" id="login-username" placeholder="用戶名" required>
    <input type="password" id="login-password" placeholder="密碼" required>
    <button type="submit">登入</button>
    <button id="toggle-register" type="button">沒有帳號嗎？註冊</button>
    <button id="forgot-password" type="button">忘記密碼？</button>
  </form>

  <!-- 註冊表單 -->
  <form id="register-form">
    <h2>註冊</h2>
    <input type="text" id="register-username" placeholder="用戶名" required>
    <input type="password" id="register-password" placeholder="密碼" required>
    <input type="email" id="register-email" placeholder="電子郵件" required>
    <button type="submit">註冊</button>
    <button id="toggle-login" type="button">已經有帳號了？登入</button>
  </form>

  <!-- 帳號管理區域 -->
  <div id="account-section" class="hidden">
    <h2>歡迎，<span id="account-username"></span></h2>
    <p>管理您的帳戶：</p>
    <form id="update-password-form">
      <input type="password" id="new-password" placeholder="新密碼" required>
      <button type="submit">更新密碼</button>
    </form>
    <button id="logout">登出</button>
  </div>

  <script>
    // 本地儲存和狀態處理
    const saveUser = (user) => {
      const users = JSON.parse(localStorage.getItem('users')) || [];
      users.push(user);
      localStorage.setItem('users', JSON.stringify(users));
    };

    const findUser = (username) => {
      const users = JSON.parse(localStorage.getItem('users')) || [];
      return users.find(user => user.username === username);
    };

    const updateUser = (username, updates) => {
      const users = JSON.parse(localStorage.getItem('users')) || [];
      const index = users.findIndex(user => user.username === username);
      if (index !== -1) {
        users[index] = { ...users[index], ...updates };
        localStorage.setItem('users', JSON.stringify(users));
      }
    };

    const setActiveUser = (username) => {
      localStorage.setItem('activeUser', username);
    };

    const getActiveUser = () => {
      return localStorage.getItem('activeUser');
    };

    const clearActiveUser = () => {
      localStorage.removeItem('activeUser');
    };

    // 切換表單
    document.getElementById('toggle-register').addEventListener('click', () => {
      document.getElementById('login-form').classList.remove('active');
      document.getElementById('register-form').classList.add('active');
    });

    document.getElementById('toggle-login').addEventListener('click', () => {
      document.getElementById('register-form').classList.remove('active');
      document.getElementById('login-form').classList.add('active');
    });

    // 註冊
    document.getElementById('register-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('register-username').value;
      const password = document.getElementById('register-password').value;
      const email = document.getElementById('register-email').value;

      if (findUser(username)) {
        alert('用戶名已存在，請嘗試其他名稱！');
        return;
      }

      saveUser({ username, password, email });
      alert('註冊成功！請登入。');
      document.getElementById('toggle-login').click();
    });

    // 登入
    document.getElementById('login-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = document.getElementById('login-username').value;
      const password = document.getElementById('login-password').value;
      const user = findUser(username);

      if (user && user.password === password) {
        setActiveUser(username);
        showAccountSection(username);
      } else {
        alert('用戶名或密碼錯誤！');
      }
    });

    // 忘記密碼
    document.getElementById('forgot-password').addEventListener('click', () => {
      const username = prompt('請輸入用戶名：');
      const user = findUser(username);

      if (user) {
        alert(`重置密碼連結已發送至 ${user.email}（模擬功能）`);
      } else {
        alert('無此用戶，請檢查用戶名是否正確。');
      }
    });

    // 更新密碼
    document.getElementById('update-password-form').addEventListener('submit', (e) => {
      e.preventDefault();
      const username = getActiveUser();
      const newPassword = document.getElementById('new-password').value;

      updateUser(username, { password: newPassword });
      alert('密碼更新成功！');
    });

    // 登出
    document.getElementById('logout').addEventListener('click', () => {
      clearActiveUser();
      document.getElementById('account-section').classList.remove('active');
      document.getElementById('login-form').classList.add('active');
    });

    // 登入狀態保持
    const showAccountSection = (username) => {
      document.getElementById('account-section').classList.add('active');
      document.getElementById('login-form').classList.remove('active');
      document.getElementById('register-form').classList.remove('active');
      document.getElementById('account-username').textContent = username;
    };

    const activeUser = getActiveUser();
    if (activeUser) {
      showAccountSection(activeUser);
    }
  </script>
</body>
</html>
